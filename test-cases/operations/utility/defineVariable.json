{
  "name": "DefineVariable Function Tests",
  "description": "Tests for the defineVariable() function",
  "tests": [
    {
      "name": "simple defineVariable",
      "expression": "defineVariable('x', 5).select(%x)",
      "input": [{}],
      "expected": [5],
      "tags": [ "defineVariable", "select" ]
    },
    {
      "name": "simple defineVariable with empty input",
      "expression": "defineVariable('x', 5).select(%x)",
      "input": [],
      "expected": [],
      "tags": [ "defineVariable", "select" ]
    },
    {
      "name": "defineVariable from input",
      "expression": "defineVariable('x', value).select(%x)",
      "input": [{"value": 5}],
      "expected": [5],
      "tags": [ "defineVariable", "select"]
    },
    {
      "name": "defineVariable - with expression inside",
      "expression": "defineVariable('sum', a + b).select(%sum)",
      "input": [ { "a": 1, "b": 2 } ],
      "expected": [ 3 ],
      "tags": [ "defineVariable", "select", "+" ]
    },
    {
      "name": "defineVariable - chained definitions",
      "expression": "defineVariable('x', value).defineVariable('y', %x * 2).defineVariable('z', %x + %y).select(%z)",
      "input": [ { "value": 5 } ],
      "expected": [ 15 ],
      "tags": [ "defineVariable", "select", "*" ]
    },
    {
      "name": "defineVariable - property access with $this",
      "expression": "property.defineVariable('x', $this).select(%x)",
      "description": "defineVariable should set $this to input",
      "input": [ { "property": 1 } ],
      "expected": [ 1 ],
      "tags": [ "defineVariable", "select", "$this" ]
    },
    {
      "name": "defineVariable - nested property access",
      "expression": "property.defineVariable('x', value).select(%x)",
      "description": "defineVariable should set $this to input",
      "input": [ { "property": { "value": 1 } } ],
      "expected": [ 1 ],
      "tags": [ "defineVariable", "select", "context-propagation" ]
    },
    {
      "name": "defineVariable - nested property access",
      "expression": "property.defineVariable('x', $this.value).select(%x)",
      "description": "defineVariable should set $this to input",
      "input": [ { "property": { "value": 1 } } ],
      "expected": [ 1 ],
      "tags": [ "defineVariable", "select", "context-propagation" ]
    }
  ]
}