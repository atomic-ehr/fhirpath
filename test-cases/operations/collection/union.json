{
  "name": "Union Operator Tests",
  "description": "Tests for the | (union) operator",
  "tests": [
    {
      "name": "union - removes duplicates",
      "expression": "{1, 2, 3}.union({3, 4, 5})",
      "input": [],
      "expected": [
        1,
        2,
        3,
        4,
        5
      ],
      "tags": [
        "function",
        "set",
        "union",
        "operator:|"
      ]
    },
    {
      "name": "union - no duplicates",
      "expression": "{1, 2, 3}.union({4, 5, 6})",
      "input": [],
      "expected": [
        1,
        2,
        3,
        4,
        5,
        6
      ],
      "tags": [
        "function",
        "set",
        "union",
        "operator:|"
      ]
    },
    {
      "name": "union - numbers",
      "expression": "{1, 2} | {3, 4}",
      "input": [],
      "expected": [
        1,
        2,
        3,
        4
      ],
      "tags": [
        "operator",
        "union",
        "collection",
        "operator:|"
      ]
    },
    {
      "name": "union - strings",
      "expression": "{'a', 'b'} | {'c', 'd'}",
      "input": [],
      "expected": [
        "a",
        "b",
        "c",
        "d"
      ],
      "tags": [
        "operator",
        "union",
        "collection",
        "string",
        "operator:|"
      ]
    },
    {
      "name": "union - multiple",
      "expression": "{1} | {2} | {3}",
      "input": [],
      "expected": [
        1,
        2,
        3
      ],
      "tags": [
        "operator",
        "union",
        "collection",
        "multiple",
        "operator:|"
      ]
    },
    {
      "name": "union with navigation",
      "expression": "a | b | c",
      "input": [
        {
          "a": 1,
          "b": 2,
          "c": 3
        }
      ],
      "expected": [
        1,
        2,
        3
      ],
      "tags": [
        "operator",
        "union",
        "navigation",
        "operator:|"
      ]
    },
    {
      "name": "union operator uses separate contexts for left and right",
      "expression": "defineVariable('x', 5).select(%x) | defineVariable('y', 10).select(%x)",
      "input": [
        {}
      ],
      "expected": [],
      "error": {
        "type": "EvaluationError",
        "message": "Variable.*%x.*not.*defined.*scope",
        "phase": "evaluate"
      },
      "tags": [
        "operator",
        "union",
        "operator:|",
        "variable",
        "scoping",
        "defineVariable"
      ],
      "description": "Variables defined on left side of union should not be visible on right side"
    },
    {
      "name": "union operator preserves values from both sides",
      "expression": "defineVariable('x', 5).select(%x) | defineVariable('x', 10).select(%x)",
      "input": [
        {}
      ],
      "expected": [
        5,
        10
      ],
      "tags": [
        "operator",
        "union",
        "operator:|",
        "variable",
        "scoping",
        "defineVariable"
      ],
      "description": "Each side of union can define its own variables independently"
    }
  ]
}
