{
  "name": "Variables",
  "description": "Tests for variable references",
  "tests": [
    {
      "name": "user-defined variable",
      "expression": "%myVar",
      "input": [],
      "context": {
        "variables": {
          "myVar": [
            1,
            2,
            3
          ]
        }
      },
      "expected": [
        1,
        2,
        3
      ],
      "tags": [
        "variable",
        "user-defined"
      ]
    },
    {
      "name": "undefined variable throws error",
      "expression": "%undefinedVar",
      "input": [],
      "expected": [],
      "error": {
        "type": "EvaluationError",
        "message": "Variable.*undefinedVar.*not.*defined",
        "phase": "analyze",
        "code": "FP1004"
      },
      "tags": [
        "variable",
        "undefined",
        "error"
      ]
    },
    {
      "name": "$this in select expression",
      "expression": "name.select($this)",
      "input": [
        {
          "name": [
            1
          ]
        },
        {
          "name": [
            2
          ]
        }
      ],
      "expected": [
        1,
        2
      ],
      "tags": [
        "variable",
        "$this",
        "select"
      ]
    },
    {
      "name": "$this in nested navigation",
      "expression": "name.given.select($this)",
      "input": [
        {
          "name": [
            {
              "given": [
                1
              ]
            }
          ]
        },
        {
          "name": [
            {
              "given": [
                2
              ]
            }
          ]
        }
      ],
      "expected": [
        1,
        2
      ],
      "tags": [
        "variable",
        "$this",
        "navigation",
        "select"
      ]
    },
    {
      "name": "%context variable",
      "expression": "%context",
      "input": [
        {
          "id": "123"
        }
      ],
      "expected": [
        {
          "id": "123"
        }
      ],
      "tags": [
        "variable",
        "%context"
      ]
    },
    {
      "name": "defined but empty environment variable returns empty",
      "expression": "%emptyVar",
      "input": [],
      "context": {
        "variables": {
          "emptyVar": []
        }
      },
      "expected": [],
      "tags": [
        "variable",
        "environment",
        "empty"
      ]
    },
    {
      "name": "multiple undefined variables throws error",
      "expression": "%var1 + %var2",
      "input": [],
      "expected": [],
      "error": {
        "type": "EvaluationError",
        "message": "Variable.*var1.*not.*defined",
        "phase": "analyze",
        "code": "FP1004"
      },
      "tags": [
        "variable",
        "undefined",
        "error",
        "operator:+"
      ]
    }
  ]
}
